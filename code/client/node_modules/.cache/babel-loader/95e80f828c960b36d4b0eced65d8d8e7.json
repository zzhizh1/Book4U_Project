{"ast":null,"code":"import { useEffect, useContext, useRef } from 'react';\nimport { warn } from './debug';\nimport { COMMAND } from './keepAliveDecorator';\nimport IdentificationContext from '../contexts/IdentificationContext';\nexport default function useKeepAliveEffect(effect) {\n  if (!useEffect) {\n    warn('[React Keep Alive] useKeepAliveEffect API requires react 16.8 or later.');\n  }\n\n  var _a = useContext(IdentificationContext),\n      eventEmitter = _a.eventEmitter,\n      identification = _a.identification;\n\n  var effectRef = useRef(effect);\n  effectRef.current = effect;\n  useEffect(function () {\n    var bindActivate = null;\n    var bindUnactivate = null;\n    var bindUnmount = null;\n    var effectResult = effectRef.current();\n    var unmounted = false;\n    eventEmitter.on([identification, COMMAND.ACTIVATE], bindActivate = function () {\n      // Delayed update\n      Promise.resolve().then(function () {\n        effectResult = effectRef.current();\n      });\n      unmounted = false;\n    }, true);\n    eventEmitter.on([identification, COMMAND.UNACTIVATE], bindUnactivate = function () {\n      if (effectResult) {\n        effectResult();\n        unmounted = true;\n      }\n    }, true);\n    eventEmitter.on([identification, COMMAND.UNMOUNT], bindUnmount = function () {\n      if (effectResult) {\n        effectResult();\n        unmounted = true;\n      }\n    }, true);\n    return function () {\n      if (effectResult && !unmounted) {\n        effectResult();\n      }\n\n      eventEmitter.off([identification, COMMAND.ACTIVATE], bindActivate);\n      eventEmitter.off([identification, COMMAND.UNACTIVATE], bindUnactivate);\n      eventEmitter.off([identification, COMMAND.UNMOUNT], bindUnmount);\n    };\n  }, []);\n}","map":{"version":3,"sources":["/Users/miabb/node_modules/react-component-keepalive/es/utils/useKeepAliveEffect.js"],"names":["useEffect","useContext","useRef","warn","COMMAND","IdentificationContext","useKeepAliveEffect","effect","_a","eventEmitter","identification","effectRef","current","bindActivate","bindUnactivate","bindUnmount","effectResult","unmounted","on","ACTIVATE","Promise","resolve","then","UNACTIVATE","UNMOUNT","off"],"mappings":"AAAA,SAASA,SAAT,EAAoBC,UAApB,EAAgCC,MAAhC,QAA8C,OAA9C;AACA,SAASC,IAAT,QAAqB,SAArB;AACA,SAASC,OAAT,QAAwB,sBAAxB;AACA,OAAOC,qBAAP,MAAkC,mCAAlC;AACA,eAAe,SAASC,kBAAT,CAA4BC,MAA5B,EAAoC;AAC/C,MAAI,CAACP,SAAL,EAAgB;AACZG,IAAAA,IAAI,CAAC,yEAAD,CAAJ;AACH;;AACD,MAAIK,EAAE,GAAGP,UAAU,CAACI,qBAAD,CAAnB;AAAA,MAA4CI,YAAY,GAAGD,EAAE,CAACC,YAA9D;AAAA,MAA4EC,cAAc,GAAGF,EAAE,CAACE,cAAhG;;AACA,MAAIC,SAAS,GAAGT,MAAM,CAACK,MAAD,CAAtB;AACAI,EAAAA,SAAS,CAACC,OAAV,GAAoBL,MAApB;AACAP,EAAAA,SAAS,CAAC,YAAY;AAClB,QAAIa,YAAY,GAAG,IAAnB;AACA,QAAIC,cAAc,GAAG,IAArB;AACA,QAAIC,WAAW,GAAG,IAAlB;AACA,QAAIC,YAAY,GAAGL,SAAS,CAACC,OAAV,EAAnB;AACA,QAAIK,SAAS,GAAG,KAAhB;AACAR,IAAAA,YAAY,CAACS,EAAb,CAAgB,CAACR,cAAD,EAAiBN,OAAO,CAACe,QAAzB,CAAhB,EAAoDN,YAAY,GAAG,YAAY;AAC3E;AACAO,MAAAA,OAAO,CAACC,OAAR,GAAkBC,IAAlB,CAAuB,YAAY;AAC/BN,QAAAA,YAAY,GAAGL,SAAS,CAACC,OAAV,EAAf;AACH,OAFD;AAGAK,MAAAA,SAAS,GAAG,KAAZ;AACH,KAND,EAMG,IANH;AAOAR,IAAAA,YAAY,CAACS,EAAb,CAAgB,CAACR,cAAD,EAAiBN,OAAO,CAACmB,UAAzB,CAAhB,EAAsDT,cAAc,GAAG,YAAY;AAC/E,UAAIE,YAAJ,EAAkB;AACdA,QAAAA,YAAY;AACZC,QAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,KALD,EAKG,IALH;AAMAR,IAAAA,YAAY,CAACS,EAAb,CAAgB,CAACR,cAAD,EAAiBN,OAAO,CAACoB,OAAzB,CAAhB,EAAmDT,WAAW,GAAG,YAAY;AACzE,UAAIC,YAAJ,EAAkB;AACdA,QAAAA,YAAY;AACZC,QAAAA,SAAS,GAAG,IAAZ;AACH;AACJ,KALD,EAKG,IALH;AAMA,WAAO,YAAY;AACf,UAAID,YAAY,IAAI,CAACC,SAArB,EAAgC;AAC5BD,QAAAA,YAAY;AACf;;AACDP,MAAAA,YAAY,CAACgB,GAAb,CAAiB,CAACf,cAAD,EAAiBN,OAAO,CAACe,QAAzB,CAAjB,EAAqDN,YAArD;AACAJ,MAAAA,YAAY,CAACgB,GAAb,CAAiB,CAACf,cAAD,EAAiBN,OAAO,CAACmB,UAAzB,CAAjB,EAAuDT,cAAvD;AACAL,MAAAA,YAAY,CAACgB,GAAb,CAAiB,CAACf,cAAD,EAAiBN,OAAO,CAACoB,OAAzB,CAAjB,EAAoDT,WAApD;AACH,KAPD;AAQH,GAjCQ,EAiCN,EAjCM,CAAT;AAkCH","sourcesContent":["import { useEffect, useContext, useRef } from 'react';\r\nimport { warn } from './debug';\r\nimport { COMMAND } from './keepAliveDecorator';\r\nimport IdentificationContext from '../contexts/IdentificationContext';\r\nexport default function useKeepAliveEffect(effect) {\r\n    if (!useEffect) {\r\n        warn('[React Keep Alive] useKeepAliveEffect API requires react 16.8 or later.');\r\n    }\r\n    var _a = useContext(IdentificationContext), eventEmitter = _a.eventEmitter, identification = _a.identification;\r\n    var effectRef = useRef(effect);\r\n    effectRef.current = effect;\r\n    useEffect(function () {\r\n        var bindActivate = null;\r\n        var bindUnactivate = null;\r\n        var bindUnmount = null;\r\n        var effectResult = effectRef.current();\r\n        var unmounted = false;\r\n        eventEmitter.on([identification, COMMAND.ACTIVATE], bindActivate = function () {\r\n            // Delayed update\r\n            Promise.resolve().then(function () {\r\n                effectResult = effectRef.current();\r\n            });\r\n            unmounted = false;\r\n        }, true);\r\n        eventEmitter.on([identification, COMMAND.UNACTIVATE], bindUnactivate = function () {\r\n            if (effectResult) {\r\n                effectResult();\r\n                unmounted = true;\r\n            }\r\n        }, true);\r\n        eventEmitter.on([identification, COMMAND.UNMOUNT], bindUnmount = function () {\r\n            if (effectResult) {\r\n                effectResult();\r\n                unmounted = true;\r\n            }\r\n        }, true);\r\n        return function () {\r\n            if (effectResult && !unmounted) {\r\n                effectResult();\r\n            }\r\n            eventEmitter.off([identification, COMMAND.ACTIVATE], bindActivate);\r\n            eventEmitter.off([identification, COMMAND.UNACTIVATE], bindUnactivate);\r\n            eventEmitter.off([identification, COMMAND.UNMOUNT], bindUnmount);\r\n        };\r\n    }, []);\r\n}\r\n"]},"metadata":{},"sourceType":"module"}